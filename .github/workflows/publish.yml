name: Publish

on: workflow_call

jobs:
  hello:
    name: "Hello"

    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup SSH
      uses: "./.github/actions/ssh"
      with:
        known-hosts: ${{secrets.KNOWN_HOSTS}}
        ssh-key: ${{secrets.SSH_KEY}}
        host: ${{secrets.SSH_HOST}}
        user: ${{secrets.SSH_USERNAME}}

    - name: Cmd
      run: |
        ssh ${{ secrets.SSH_HOST }} cat test
      shell: bash

    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.24'

    - name: Go Build
      run: go build -v -o ../bin/ cmd/api/main.go
      working-directory: "./api"

    - name: Install
      run: npm ci
      working-directory: "./client"

    - name: Build
      run: npm run build
      working-directory: "./client"

    - name: Copy
      run: cp -R ./client/dist bin/static

    - name: LS
      run: ls bin/

    - name: Rsync
      run: |
        whereis rsync
        whereis scp

    - name: Cmd
      run: |
        rsync -r bin/ ${{ secrets.SSH_HOST }}:nutrition-tracker/
      shell: bash
